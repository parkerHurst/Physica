app-id: org.physicaapp.Physica
runtime: org.gnome.Platform
runtime-version: '45'
sdk: org.gnome.Sdk
command: physica
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=x11
  - --socket=session-bus
  - --socket=system-bus
  - --device=dri
  - --device=all
  - --filesystem=home
  - --filesystem=host
  - --filesystem=/media:ro
  - --filesystem=/run/media:ro
  - --filesystem=/mnt:ro
  - --talk-name=org.freedesktop.UDisks2
  - --talk-name=org.freedesktop.DBus
  - --talk-name=org.freedesktop.systemd1
  - --own-name=org.physicaapp.Service
  - --own-name=org.physicaapp.App

modules:
  - name: physica-service
    buildsystem: simple
    build-commands:
      - install -Dm755 main.py $FLATPAK_DEST/bin/physica-service
      - install -Dm755 dbus_service.py $FLATPAK_DEST/lib/python3.13/site-packages/dbus_service.py
      - install -Dm755 cartridge.py $FLATPAK_DEST/lib/python3.13/site-packages/cartridge.py
      - install -Dm755 cartridge_registry.py $FLATPAK_DEST/lib/python3.13/site-packages/cartridge_registry.py
      - install -Dm755 cartridge_scanner.py $FLATPAK_DEST/lib/python3.13/site-packages/cartridge_scanner.py
      - install -Dm755 config.py $FLATPAK_DEST/lib/python3.13/site-packages/config.py
      - install -Dm755 game_launcher.py $FLATPAK_DEST/lib/python3.13/site-packages/game_launcher.py
      - install -Dm644 requirements.txt $FLATPAK_DEST/lib/python3.13/site-packages/requirements.txt
    sources:
      - type: dir
        path: ../service

  - name: physica-gtk-app
    buildsystem: simple
    build-commands:
      - install -Dm755 run.py $FLATPAK_DEST/bin/physica
      - install -Dm755 physica_gtk/__init__.py $FLATPAK_DEST/lib/python3.13/site-packages/physica_gtk/__init__.py
      - install -Dm755 physica_gtk/main.py $FLATPAK_DEST/lib/python3.13/site-packages/physica_gtk/main.py
      - install -Dm755 physica_gtk/window.py $FLATPAK_DEST/lib/python3.13/site-packages/physica_gtk/window.py
      - install -Dm755 physica_gtk/game_card.py $FLATPAK_DEST/lib/python3.13/site-packages/physica_gtk/game_card.py
      - install -Dm755 physica_gtk/import_wizard.py $FLATPAK_DEST/lib/python3.13/site-packages/physica_gtk/import_wizard.py
      - install -Dm755 physica_gtk/dbus_client.py $FLATPAK_DEST/lib/python3.13/site-packages/physica_gtk/dbus_client.py
      - install -Dm644 physica_gtk/style.css $FLATPAK_DEST/share/physica/gtk-app/physica_gtk/style.css
      - install -Dm644 requirements.txt $FLATPAK_DEST/lib/python3.13/site-packages/requirements.txt
    sources:
      - type: dir
        path: ../gtk-app

  - name: physica-desktop-file
    buildsystem: simple
    build-commands:
      - install -Dm644 physica.desktop $FLATPAK_DEST/share/applications/org.physicaapp.Physica.desktop
    sources:
      - type: file
        path: physica.desktop

  - name: physica-icon
    buildsystem: simple
    build-commands:
      - install -Dm644 physica.svg $FLATPAK_DEST/share/icons/hicolor/scalable/apps/org.physicaapp.Physica.svg
    sources:
      - type: file
        path: physica.svg
